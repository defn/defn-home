#!/usr/bin/env bash

function home_update {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"

  source "$shome/script/profile"
  "$shome/script/clean"

  local tmp_rc="$(mktemp -t "XXXXXX")"
  export APP_RC_CACHE="$tmp_rc"

  time DEBUG=1 require

  local tmp_rc2="$shome/.bashrc.app.$(basename "$tmp_rc")"
  mv "$tmp_rc" "$tmp_rc2"
  mv -f "$tmp_rc2" "$shome/.bashrc.app"
}

home_update "$@"
