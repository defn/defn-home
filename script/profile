#!/usr/bin/env bash

function profile {
  local shome="$(unset CDPATH; cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"
  PATH="$shome/bin:$shome/exec:$PATH"

  source app_strict
  source app_shortcuts
  source app_debug

  export PKG_HOME="$shome"

  require jq

  local nm_block
  for nm_block in $(cat "$shome/Blockfile" | yq -r '[.require[] | [.] | flatten] | flatten[]'); do
    if require "$nm_block"; then
      true
    fi
  done

  source home_iterm

  export GIT_SSH="$(which cache-git 2>&- || echo ssh)"
}

profile
