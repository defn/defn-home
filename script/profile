#!/usr/bin/env bash

function profile {
  local shome="$(unset CDPATH; cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"
  PATH="$shome/bin:$shome/exec:$shome/node_modules/.bin:$PATH"

  source ~/work/app/script/profile \
    || echo "ERROR: something's wrong with app's profile"

  if pushd ~/work 1>&-; then
    require virtualenv ansible aws \
      || echo "ERROR: something's wrong with a required profile"
    require erlang elixir rocco \
      || echo "ERROR: something's wrong with a required profile"
    require ruby rocco \
      || echo "ERROR: something's wrong with a required profile"
    require node dnsimple \
      || echo "ERROR: something's wrong with a required profile"
    require jq \
      || echo "ERROR: something's wrong with a required profile"
    require cue junas defn \
      || echo "ERROR: something's wrong with a required profile"
    require runmany deploy \
      || echo "ERROR: something's wrong with a required profile"
    popd 1>&-
  fi
}

profile
