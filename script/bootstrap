#!/usr/bin/env bash

function pkg_ensure {
  local nm_pkg="$1"; shift
  local nm_build="${1:-$nm_pkg}"

  pkg install "$nm_pkg" || { pkg package "$nm_build" && pkg install "$nm_pkg"; }
}

function bootstrap_pkgsrc {
  pkg_ensure security/mozilla-rootcerts
  mozilla-rootcerts install || true

  pkg_ensure security/spiped
  pkg_ensure misc/getopt
  pkg_ensure misc/tmux
  pkg_ensure net/wget
  pkg_ensure www/curl
  pkg_ensure devel/jq
  pkg_ensure www/squid www/squid3
  pkg_ensure devel/editline
  pkg_ensure misc/rlwrap
  pkg_ensure sysutils/runit
  pkg_ensure sysutils/cdrtools
  pkg_ensure www/nginx
  pkg_ensure databases/redis
  pkg_ensure databases/postgresql94-server
  pkg_ensure databases/mysql-server databases/mysql55-server
  pkg_ensure databases/percona-toolkit
  pkg_ensure databases/mongodb
  pkg_ensure lang/erlang
  pkg_ensure chat/irssi
 }

function home_bootstrap {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"

  app clone

  "$shome/script/update"
  source "$shome/script/profile"

  bootstrap_pkgsrc
}

home_bootstrap "$@"
